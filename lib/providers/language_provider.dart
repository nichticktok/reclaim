import 'package:flutter/material.dart';

class LangOption {
  final String id;     // stable id, e.g. "18_24"
  final String label;  // localized label
  const LangOption({required this.id, required this.label});
}

class LanguageProvider extends ChangeNotifier {
  String _currentLang = 'English';
  String get currentLang => _currentLang;

  void setLanguage(String newLang) {
    if (_currentLang == newLang) return;
    _currentLang = newLang;
    notifyListeners();
  }

  // ЁЯФв Nepali number map
  static const Map<String, String> _nepaliNumbers = {
    '0': 'реж', '1': 'рез', '2': 'реи', '3': 'рей', '4': 'рек',
    '5': 'рел', '6': 'рем', '7': 'рен', '8': 'рео', '9': 'реп',
  };

  // ЁЯСЙ Option ordering per screen (UI order is language-agnostic)
  static const Map<String, List<String>> _screenOptionOrder = {
    'onboarding_age'   : ['13_17','18_24','25_34','35_44','45_54','55_plus'],
    'onboarding_gender': ['male','female','other','prefer_not'],
    'onboarding_main'  : ['main_today','main_week','main_months','main_cant_remember'],
    'onboarding_life'  : [
      'life_satisfied',
      'life_self_improve',
      'life_okay_neutral',
      'life_often_sad',
      'life_lowest_need_help',
    ],
    // Journey Drive screen
    'onboarding_drive' : ['ambition','love','growth','peace','curiosity'],
    // тЬЕ Dark Habits screen
    'onboarding_dark'  : [
      'procrastination',
      'overthinking',
      'negativity',
      'addiction_phone_social',
      'lack_self_discipline',
      'poor_sleep',
    ],
  };

  /// ЁЯФд Translations
  final Map<String, Map<String, String>> _translations = {
    'English': {
      // Common
      'word_step': 'Step',
      'word_of'  : 'of',
      'language' : 'Language',
      'next'     : 'Next тЖТ',
      'confirm'  : 'Confirm',
      'continue' : 'Continue',
      'skip'     : 'Skip тЖТ',
      'welcome'  : 'Welcome to Reclaim ЁЯСЛ',
      'namePrompt': "Let's start by knowing your name.",
      'howOld'   : 'How old are you?',
      'genderQuestion': "What's your gender?",
      'chooseCharacter': 'Choose your character',
      'female'   : 'Female',
      'male'     : 'Male',
      'awakening_line1': 'You were just another face in',
      'awakening_line2': 'the crowd.',
      'awakening_line3': 'Tired. Stuck. Running on\nautopilot... until now.',

      // Age screen
      'onboarding_age.title'   : 'How old are you?',
      'onboarding_age.13_17'   : '13 to 17',
      'onboarding_age.18_24'   : '18 to 24',
      'onboarding_age.25_34'   : '25 to 34',
      'onboarding_age.35_44'   : '35 to 44',
      'onboarding_age.45_54'   : '45 to 54',
      'onboarding_age.55_plus' : '55 or above',

      // Gender screen
      'onboarding_gender.title'     : "What's your gender?",
      'onboarding_gender.male'      : 'Male',
      'onboarding_gender.female'    : 'Female',
      'onboarding_gender.other'     : 'Other',
      'onboarding_gender.prefer_not': 'Prefer not to answer',

      // Main Character screen
      'onboarding_main.title'             : 'When did you last feel like the main character?',
      'onboarding_main.main_today'        : 'Today тАФ IтАЩm on a roll lately!',
      'onboarding_main.main_week'         : 'This week тАФ IтАЩve been consistent.',
      'onboarding_main.main_months'       : 'ItтАЩs been months, IтАЩve lost touch.',
      'onboarding_main.main_cant_remember': 'I canтАЩt even remember the last time.',

      // Life Description screen
      'onboarding_life.title'                : 'How would you describe your current life?',
      'onboarding_life.life_satisfied'       : "I'm satisfied with my life now",
      'onboarding_life.life_self_improve'    : "I'm alright and want to self-improve",
      'onboarding_life.life_okay_neutral'    : "I'm doing okay, not good or bad",
      'onboarding_life.life_often_sad'       : "I'm often sad and rarely happy",
      'onboarding_life.life_lowest_need_help': "I'm at the lowest and need help",

      // Journey Drive screen
      'onboarding_drive.title'     : 'What drives your journey every day?',
      'onboarding_drive.ambition'  : 'Ambition тАФ I want to achieve greatness.',
      'onboarding_drive.love'      : 'Love тАФ I care deeply for the people around me.',
      'onboarding_drive.growth'    : 'Growth тАФ I want to become a better version of myself.',
      'onboarding_drive.peace'     : 'Peace тАФ I just want balance and calm.',
      'onboarding_drive.curiosity' : 'Curiosity тАФ I want to explore everything life offers.',

      // тЬЕ Dark Habits screen
      'onboarding_dark.title'                    : 'Any dark habits holding your power back?',
      'onboarding_dark.procrastination'          : 'Procrastination',
      'onboarding_dark.overthinking'             : 'Overthinking',
      'onboarding_dark.negativity'               : 'Negativity',
      'onboarding_dark.addiction_phone_social'   : 'Addiction to phone/socials',
      'onboarding_dark.lack_self_discipline'     : 'Lack of self-discipline',
      'onboarding_dark.poor_sleep'               : 'Poor sleep routine',
    },

    'Nepali': {
      // Common
      'word_step': 'рдЪрд░рдг',
      'word_of'  : 'рдХреЛ',
      'language' : 'рднрд╛рд╖рд╛',
      'next'     : 'рдЕрд░реНрдХреЛ тЖТ',
      'confirm'  : 'рдкреБрд╖реНрдЯрд┐ рдЧрд░реНрдиреБрд╣реЛрд╕реН',
      'continue' : 'рдЬрд╛рд░реА рд░рд╛рдЦреНрдиреБрд╣реЛрд╕реН',
      'skip'     : 'рдЫреЛрдбреНрдиреБрд╣реЛрд╕реН тЖТ',
      'welcome'  : 'Reclaim рдорд╛ рд╕реНрд╡рд╛рдЧрдд рдЫ ЁЯСЛ',
      'namePrompt': 'рддрдкрд╛рдИрдВрдХреЛ рдирд╛рдо рдмрддрд╛рдЙрдиреБрд╣реЛрд╕реНред',
      'howOld'   : 'рддрдкрд╛рдИрдВрдХреЛ рдЙрдореЗрд░ рдХрддрд┐ рд╣реЛ?',
      'genderQuestion': 'рддрдкрд╛рдИрдВрдХреЛ рд▓рд┐рдЩреНрдЧ рдХреЗ рд╣реЛ?',
      'chooseCharacter': 'рддрдкрд╛рдИрдВрдХреЛ рдкрд╛рддреНрд░ рдЫрд╛рдиреНрдиреБрд╣реЛрд╕реН',
      'female'   : 'рдорд╣рд┐рд▓рд╛',
      'male'     : 'рдкреБрд░реБрд╖',
      'awakening_line1': 'рддрдкрд╛рдИрдВ рднреАрдбрдорд╛ рдЕрд░реВ рдЬрд╕реНрддреИ рдорд╛рддреНрд░ рд╣реБрдиреБрд╣реБрдиреНрдереНрдпреЛ',
      'awakening_line2': 'рднреАрдбрдорд╛ рд╣рд░рд╛рдЙрдиреБ рднрдПрдХреЛ рдерд┐рдпреЛред',
      'awakening_line3': 'рдердХрд┐рддред рд░реЛрдХрд┐рдПрдХрд╛ред рд╕реНрд╡рдд: рдврдВрдЧрд▓реЗ рдмрд╛рдБрдЪрд┐рд░рд╣реЗрдХрд╛... рдЕрдм рд╣реЛрдЗрдиред',

      // Age screen
      'onboarding_age.title'   : 'рддрдкрд╛рдИрдВрдХреЛ рдЙрдореЗрд░ рдХрддрд┐ рд╣реЛ?',
      'onboarding_age.13_17'   : 'резрей рджреЗрдЦрд┐ резрен',
      'onboarding_age.18_24'   : 'резрео рджреЗрдЦрд┐ реирек',
      'onboarding_age.25_34'   : 'реирел рджреЗрдЦрд┐ рейрек',
      'onboarding_age.35_44'   : 'рейрел рджреЗрдЦрд┐ рекрек',
      'onboarding_age.45_54'   : 'рекрел рджреЗрдЦрд┐ релрек',
      'onboarding_age.55_plus' : 'релрел рд╡рд╛ рдорд╛рдерд┐',

      // Gender screen
      'onboarding_gender.title'     : 'рддрдкрд╛рдИрдВрдХреЛ рд▓рд┐рдЩреНрдЧ рдХреЗ рд╣реЛ?',
      'onboarding_gender.male'      : 'рдкреБрд░реБрд╖',
      'onboarding_gender.female'    : 'рдорд╣рд┐рд▓рд╛',
      'onboarding_gender.other'     : 'рдЕрдиреНрдп',
      'onboarding_gender.prefer_not': 'рднрдиреНрди рдЪрд╛рд╣рдиреНрди',

      // Main Character screen
      'onboarding_main.title'             : 'рддрдкрд╛рдИрдВрд▓реЗ рдЕрдиреНрддрд┐рдо рдкрдЯрдХ рдореБрдЦреНрдп рдкрд╛рддреНрд░ рднрдПрдХреЛ рдорд╣рд╕реБрд╕ рдХрд╣рд┐рд▓реЗ рдЧрд░реНрдиреБрднрдпреЛ?',
      'onboarding_main.main_today'        : 'рдЖрдЬ тАФ рдо рд░рд╛рдореНрд░реЛ рд▓рдпрдорд╛ рдЫреБ!',
      'onboarding_main.main_week'         : 'рдпреЛ рд╣рдкреНрддрд╛ тАФ рдо рд▓рдЧрд╛рддрд╛рд░ рдЫреБред',
      'onboarding_main.main_months'       : 'рдорд╣рд┐рдиреМрдВ рднрдпреЛ, рдо рдЖрдлреИрдВрд╕рдБрдЧ рд╣рд░рд╛рдПрдХреЛ рдЫреБред',
      'onboarding_main.main_cant_remember': 'рдорд▓рд╛рдИ рдЕрдиреНрддрд┐рдо рдкрдЯрдХ рдпрд╛рдж рдЫреИрдиред',

      // Life Description screen
      'onboarding_life.title'                : 'рддрдкрд╛рдИрдВ рдЕрд╣рд┐рд▓реЗрдХреЛ рдЬреАрд╡рдирд▓рд╛рдИ рдХрд╕рд░реА рд╡рд░реНрдгрди рдЧрд░реНрдиреБрд╣реБрдиреНрдЫ?',
      'onboarding_life.life_satisfied'       : 'рдо рдЕрд╣рд┐рд▓реЗрдХреЛ рдЬреАрд╡рдирдмрд╛рдЯ рд╕рдиреНрддреБрд╖реНрдЯ рдЫреБ',
      'onboarding_life.life_self_improve'    : 'рдо рдареАрдХ рдЫреБ рд░ рдЖрдлреВрд▓рд╛рдИ рд╕реБрдзрд╛рд░реНрди рдЪрд╛рд╣рдиреНрдЫреБ',
      'onboarding_life.life_okay_neutral'    : 'рдо рдареАрдХреИ рдЫреБ, рди рд░рд╛рдореНрд░реЛ рди рдирд░рд╛рдореНрд░реЛ',
      'onboarding_life.life_often_sad'       : 'рдо рдкреНрд░рд╛рдпрдГ рджреБрдГрдЦреА рд╣реБрдиреНрдЫреБ рд░ рдЦреБрд╢реА рдХрдореИ рд╣реБрдиреНрдЫреБ',
      'onboarding_life.life_lowest_need_help': 'рдо рдзреЗрд░реИ рдХрдард┐рди рдЕрд╡рд╕реНрдерд╛рдорд╛ рдЫреБ рд░ рд╕рд╣рдпреЛрдЧ рдЪрд╛рд╣рд┐рдиреНрдЫ',

      // Journey Drive screen
      'onboarding_drive.title'     : 'рд╣рд░реЗрдХ рджрд┐рди рддрдкрд╛рдИрдВрдХреЛ рдпрд╛рддреНрд░рд╛рд▓рд╛рдИ рдХреЗ рдЪрд▓рд╛рдЙрдБрдЫ?',
      'onboarding_drive.ambition'  : 'рдорд╣рддреНрддреНрд╡рд╛рдХрд╛рдВрдХреНрд╖рд╛ тАФ рдо рдареВрд▓реЛ рдЙрдкрд▓рдмреНрдзрд┐ рд╣рд╛рд╕рд┐рд▓ рдЧрд░реНрди рдЪрд╛рд╣рдиреНрдЫреБред',
      'onboarding_drive.love'      : 'рдорд╛рдпрд╛ тАФ рдо рд╡рд░рдкрд░рдХрд╛ рдорд╛рдирд┐рд╕рд╣рд░реВрд▓рд╛рдИ рдЧрд╣рд┐рд░реЛ рдорд╛рдпрд╛ рдЧрд░реНрдЫреБред',
      'onboarding_drive.growth'    : 'рд╡рд┐рдХрд╛рд╕ тАФ рдо рдЖрдлреИрдБрд▓рд╛рдИ рдЕрдЭ рд░рд╛рдореНрд░реЛ рдмрдирд╛рдЙрди рдЪрд╛рд╣рдиреНрдЫреБред',
      'onboarding_drive.peace'     : 'рд╢рд╛рдиреНрддрд┐ тАФ рдо рд╕рдиреНрддреБрд▓рди рд░ рд╢рд╛рдиреНрддрд┐ рдЪрд╛рд╣рдиреНрдЫреБред',
      'onboarding_drive.curiosity' : 'рдЬрд┐рдЬреНрдЮрд╛рд╕рд╛ тАФ рдЬреАрд╡рдирд▓реЗ рджрд┐рдиреЗ рд╕рдмреИ рдХреБрд░рд╛ рдЕрдиреНрд╡реЗрд╖рдг рдЧрд░реНрди рдЪрд╛рд╣рдиреНрдЫреБред',

      // тЬЕ Dark Habits screen
      'onboarding_dark.title'                    : 'рдХреЗрд╣реА рдЦрд░рд╛рдм рдмрд╛рдиреАрд╣рд░реВрд▓реЗ рддрдкрд╛рдИрдВрдХреЛ рд╢рдХреНрддрд┐ рдШрдЯрд╛рдЗрд░рд╣реЗрдХрд╛ рдЫрдиреН?',
      'onboarding_dark.procrastination'          : 'рдХрд╛рдо рдЯрд╛рд░реНрдиреЗ рдмрд╛рдиреА',
      'onboarding_dark.overthinking'             : 'рдЕрддреНрдпрдзрд┐рдХ рд╕реЛрдЪрд╛рдЗ',
      'onboarding_dark.negativity'               : 'рдирдХрд╛рд░рд╛рддреНрдордХрддрд╛',
      'onboarding_dark.addiction_phone_social'   : 'рдлреЛрди/рд╕реЛрд╕рд▓рдорд╛ рд▓рдд',
      'onboarding_dark.lack_self_discipline'     : 'рдЖрддреНрдордЕрдиреБрд╢рд╛рд╕рдирдХреЛ рдХрдореА',
      'onboarding_dark.poor_sleep'               : 'рдирд░рд╛рдореНрд░реЛ рдирд┐рджреНрд░рд╛ рдмрд╛рдиреА',
    },
  };

  /// Basic translation getter
  String t(String key) => _translations[_currentLang]?[key] ?? key;

  /// Alias for t(): some screens call text()
  String text(String keyPath) => t(keyPath);

  /// ЁЯФв Number localization (public)
  String n(num value) => localizeNumber(value);

  /// ЁЯФв Number localization (existing)
  String localizeNumber(dynamic number) {
    final text = number.toString();
    if (_currentLang == 'Nepali') {
      return text.split('').map((c) => _nepaliNumbers[c] ?? c).join('');
    }
    return text;
  }

  /// ЁЯУЛ Return localized options for a given screen key using the order map
  List<LangOption> options(String screenKey) {
    final langMap = _translations[_currentLang] ?? const {};
    final order = _screenOptionOrder[screenKey];

    // Gather keys like "<screen>.<id>" except ".title"
    final Map<String, String> byId = {};
    for (final entry in langMap.entries) {
      if (entry.key.startsWith('$screenKey.') && entry.key != '$screenKey.title') {
        final id = entry.key.substring(screenKey.length + 1); // part after the dot
        byId[id] = entry.value;
      }
    }

    // Honor explicit order if present; otherwise fall back to discovered ids
    final List<String> ids = order?.where(byId.containsKey).toList() ?? byId.keys.toList();

    return ids.map((id) => LangOption(id: id, label: byId[id]!)).toList();
  }
}
